<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FREEPASSMOBILITY - 상품 등록</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="../css/layout.css">
</head>
<body class="h-screen overflow-hidden select-none bg-[#f1f3f6]">

<div id="toast">알림 메시지</div>

<div id="app" class="h-screen flex flex-col overflow-hidden text-slate-800 font-bold">
    <header class="h-[50px] bg-white border-b border-slate-200 flex items-center px-4 justify-between z-50 shadow-sm font-bold">
        <div class="flex items-center gap-3 font-bold">
            <div id="top-user-info" class="flex items-center gap-2 text-nowrap font-bold">
                <span id="role-tag" class="text-[9px] font-black text-blue-500 uppercase tracking-tighter border border-blue-200 px-1.5 rounded font-bold">SUPPLIER</span>
                <span id="id-tag" class="font-bold text-slate-700 font-bold">공급사 계정</span>
            </div>
        </div>
        <button onclick="location.href='../index.html'" class="text-slate-400 font-bold hover:text-rose-500 text-[10px] flex items-center gap-1 transition-colors whitespace-nowrap font-bold">
            <i data-lucide="log-out" class="w-3 h-3 font-bold"></i> 로그아웃
        </button>
    </header>

    <main class="flex-1 flex overflow-hidden relative font-bold">
        <nav class="w-[70px] bg-white border-r border-slate-200 flex flex-col items-center py-6 gap-3 z-40 shadow-sm font-bold">
            <button class="side-btn reg-btn-style active font-bold">
                <i data-lucide="plus-square" class="w-5 h-5 font-bold"></i>
                <span class="text-[8px] font-bold mt-1 text-nowrap">상품등록</span>
            </button>
            <button onclick="showMessage('개발 중인 기능입니다.')" class="side-btn font-bold">
                <i data-lucide="layout-grid" class="w-5 h-5 font-bold"></i>
                <span class="text-[8px] font-bold mt-1 text-nowrap">상품현황</span>
            </button>
        </nav>

        <section id="content-area" class="flex-1 flex flex-col min-w-0 relative font-bold">
            <div id="registration-view" class="flex flex-col h-full bg-slate-50 overflow-y-auto font-bold">
                <div class="view-title-bar font-bold">
                    <span class="view-title-text font-bold"><i data-lucide="plus-square" class="w-3.5 h-3.5 text-blue-600 font-bold"></i> 상품 등록 관리</span>
                </div>
                
                <div class="p-8 max-w-4xl font-bold">
                    <div class="bg-white subtle-rounded shadow-sm border border-slate-200 p-8 space-y-6 font-bold">
                        
                        <h3 class="text-[14px] font-black text-slate-800 border-l-4 border-blue-600 pl-3 font-bold">1단계: 차량 기본 정보</h3>
                        <div class="grid grid-cols-3 gap-6 font-bold">
                            <div class="space-y-2 font-bold">
                                <label class="text-[9px] text-slate-400 uppercase font-black font-bold">제조사</label>
                                <select id="reg-brand" onchange="updateModels()" class="w-full p-3 border subtle-rounded outline-none focus:border-blue-500 font-bold bg-slate-50">
                                    <option value="">제조사 선택</option>
                                </select>
                            </div>
                            <div class="space-y-2 font-bold">
                                <label class="text-[9px] text-slate-400 uppercase font-black font-bold">모델명 (코드명)</label>
                                <select id="reg-model" onchange="updateDetails()" class="w-full p-3 border subtle-rounded outline-none focus:border-blue-500 font-bold bg-slate-50" disabled>
                                    <option value="">모델 선택</option>
                                </select>
                            </div>
                            <div class="space-y-2 font-bold">
                                <label class="text-[9px] text-slate-400 uppercase font-black font-bold">세부모델 (페리/엔진)</label>
                                <select id="reg-trim" class="w-full p-3 border subtle-rounded outline-none focus:border-blue-500 font-bold bg-slate-50" disabled>
                                    <option value="">세부모델 선택</option>
                                </select>
                            </div>
                        </div>

                        <h3 class="text-[14px] font-black text-slate-800 border-l-4 border-blue-600 pl-3 font-bold">2단계: 대여료 및 계약 정보</h3>
                        <div class="grid grid-cols-3 gap-6 font-bold">
                            <div class="space-y-2 font-bold"><label class="text-[9px] text-slate-400 uppercase font-black font-bold">차량번호</label><input type="text" id="reg-no" placeholder="12가 3456" class="w-full p-3 border subtle-rounded outline-none focus:border-blue-500 font-bold bg-slate-50"></div>
                            <div class="space-y-2 font-bold"><label class="text-[9px] text-slate-400 uppercase font-black font-bold">월 대여료</label><input type="number" id="reg-36m" placeholder="0" class="w-full p-3 border subtle-rounded outline-none focus:border-blue-500 font-bold bg-slate-50"></div>
                            <div class="space-y-2 font-bold"><label class="text-[9px] text-slate-400 uppercase font-black font-bold">보증금</label><input type="number" id="reg-36d" placeholder="0" class="w-full p-3 border subtle-rounded outline-none focus:border-blue-500 font-bold bg-slate-50"></div>
                        </div>

                        <div class="pt-8 flex gap-4 font-bold">
                            <button onclick="saveNewCar()" class="flex-1 py-5 bg-blue-600 text-white font-black text-lg subtle-rounded shadow-lg hover:bg-blue-700 transition-all font-bold">신규 상품 등록 완료</button>
                            <button onclick="location.reload()" class="w-32 py-5 bg-slate-200 text-slate-600 font-bold subtle-rounded font-bold">초기화</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>

<script type="module">
    import { 차량마스터데이터 } from '../js/car-master.js';

    // 페이지 로드 시 제조사 드롭다운 생성
    window.onload = () => {
        const brandSelect = document.getElementById('reg-brand');
        Object.keys(차량마스터데이터).forEach(brand => {
            const opt = document.createElement('option');
            opt.value = brand;
            opt.text = brand;
            brandSelect.appendChild(opt);
        });
        lucide.createIcons();
    };

    window.updateModels = () => {
        const brand = document.getElementById('reg-brand').value;
        const modelSelect = document.getElementById('reg-model');
        const trimSelect = document.getElementById('reg-trim');
        
        modelSelect.innerHTML = '<option value="">모델 선택</option>';
        trimSelect.innerHTML = '<option value="">세부모델 선택</option>';
        trimSelect.disabled = true;

        if (brand) {
            modelSelect.disabled = false;
            Object.keys(차량마스터데이터[brand]).forEach(model => {
                const opt = document.createElement('option');
                opt.value = model;
                opt.text = model;
                modelSelect.appendChild(opt);
            });
        } else {
            modelSelect.disabled = true;
        }
    };

    window.updateDetails = () => {
        const brand = document.getElementById('reg-brand').value;
        const model = document.getElementById('reg-model').value;
        const trimSelect = document.getElementById('reg-trim');
        
        trimSelect.innerHTML = '<option value="">세부모델 선택</option>';
        
        if (model) {
            trimSelect.disabled = false;
            차량마스터데이터[brand][model].forEach(trim => {
                const opt = document.createElement('option');
                opt.value = trim;
                opt.text = trim;
                trimSelect.appendChild(opt);
            });
        } else {
            trimSelect.disabled = true;
        }
    };

    window.showMessage = (msg) => { const t = document.getElementById("toast"); t.innerText = msg; t.className = "show"; setTimeout(() => { t.className = ""; }, 3000); };
    
    // 파이어베이스 저장 로직 (기존 통합 코드 로직 그대로 유지)
    window.saveNewCar = () => {
        const no = document.getElementById('reg-no').value;
        if(!no) return showMessage('차량번호를 입력하세요.');
        showMessage(no + ' 차량이 성공적으로 등록되었습니다.');
    };

    lucide.createIcons();
</script>
</body>
</html>
